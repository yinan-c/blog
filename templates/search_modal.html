<!-- search_modal.html -->
<link href="/pagefind/pagefind-ui.css" rel="stylesheet">
<script src="/pagefind/pagefind-ui.js"></script>

<div id="search-modal" class="search-modal">
  <div class="search-modal-content">
    <!-- macOS-style close button -->
    <div class="macos-close-button">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <circle cx="12" cy="12" r="10" fill="#FF6057"></circle>
        <path d="M8.5,8.5 L15.5,15.5 M8.5,15.5 L15.5,8.5" stroke="rgba(0,0,0,0.5)" stroke-width="1.5"></path>
      </svg>
    </div>
    <div id="search"></div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Initialize PagefindUI for the search modal
    const searchInstance = new PagefindUI({
      element: "#search",
      showSubResults: true,
      autofocus: true
    });

    // Function to open the search modal
    function openSearchModal() {
      const searchModal = document.getElementById('search-modal');
      if (!searchModal) return;
      searchModal.style.display = 'flex';
      document.body.classList.add('modal-open');
      setTimeout(() => {
        const searchInput = document.querySelector('.pagefind-ui__search-input');
        if (searchInput) {
          searchInput.focus();
        }
      }, 100);
    }

    // Function to close the search modal
    function closeSearchModal() {
      const searchModal = document.getElementById('search-modal');
      if (!searchModal) return;
      searchModal.style.display = 'none';
      document.body.classList.remove('modal-open');
    }

    // Attach event listeners for triggers (if they exist)
    const searchButton = document.getElementById('search-button');
    if (searchButton) {
      searchButton.addEventListener('click', openSearchModal);
    }
    const searchText = document.getElementById('search-text');
    if (searchText) {
      searchText.addEventListener('click', function(e) {
        e.preventDefault();
        openSearchModal();
      });
    }

    // Close modal when clicking the close button
    const closeButton = document.querySelector('.macos-close-button');
    if (closeButton) {
      closeButton.addEventListener('click', closeSearchModal);
    }

    // Close modal when clicking outside the modal content
    window.addEventListener('click', function(event) {
      const searchModal = document.getElementById('search-modal');
      if (event.target === searchModal) {
        closeSearchModal();
      }
    });

    // Close modal when pressing the ESC key
    document.addEventListener('keydown', function(event) {
      const searchModal = document.getElementById('search-modal');
      if (event.key === 'Escape' && searchModal && searchModal.style.display === 'flex') {
        closeSearchModal();
      }
    });
  });
</script>

<style>
  /* Pagefind UI CSS Variables */
  :root {
    --pagefind-ui-scale: 1;
    --pagefind-ui-primary: var(--nc-lk-1);
    --pagefind-ui-text: var(--nc-tx-1);
    --pagefind-ui-background: var(--nc-bg-1);
    --pagefind-ui-border: var(--nc-bg-3);
    --pagefind-ui-tag: var(--nc-bg-2);
    --pagefind-ui-border-width: 2px;
    --pagefind-ui-border-radius: 10px;
    --pagefind-ui-image-box-ratio: 3 / 2;
    --pagefind-ui-font: var(--nc-font-sans);
  }

  /* Search Modal Styling */
  .search-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    justify-content: center;
    align-items: center;
    backdrop-filter: blur(4px);
  }
  .search-modal-content {
    position: relative;
    background-color: var(--nc-bg-1);
    color: var(--nc-tx-1);
    padding: 40px 30px 30px;
    border-radius: 16px;
    width: 80%;
    max-width: 700px;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
  }
  .macos-close-button {
    position: absolute;
    top: 15px;
    left: 15px;
    width: 24px;
    height: 24px;
    cursor: pointer;
    z-index: 10;
  }
  body.modal-open {
    overflow: hidden;
  }
</style>

